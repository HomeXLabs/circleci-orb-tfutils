description: >
  Installs tfenv, if needed, and adds the path to PATH.
  Can optionally spcify the version to be installed, however will not install if another version is already installed.

parameters:
  tfenv-version:
    type: string
    description: Install a specific version of tfenv.
    default: latest

steps:
  - run:
      name: Install TFenv
      command: |
        if which tfenv > /dev/null; then
          echo "TFenv is already installed. Skipping."
          exit 0
        fi

        if [ "<<parameters.tfenv-version >>" == "latest" ]; then
          TFENV_VERSION=$(curl -s https://api.github.com/repos/tfutils/tfenv/releases/latest | grep -oP '"tag_name": "\K(.*)(?=")')
        else
          TFENV_VERSION=<<parameters.tfenv-version>>
        fi

        echo "Installing ${TFENV_VERSION} of tfenv"

        curl -L -s -o tfenv.zip https://github.com/tfutils/tfenv/archive/${TFENV_VERSION}.zip

        mkdir -p ~/.tfenv
        unzip tfenv.zip -d ~/.tfenv/
        mv ~/.tfenv/*/* ~/.tfenv/

        echo "export PATH=$PATH:~/.tfenv/bin/" >> $BASH_ENV
